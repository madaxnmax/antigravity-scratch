<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Grade Management System</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet" />

        <style>
        .grade-card {
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .grade-header {
            background-color: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .synonym-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .synonym-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 15px;
            border-bottom: 1px solid #eee;
        }
        .synonym-item:last-child {
            border-bottom: none;
        }
        .delete-grade-btn {
            color: #dc3545;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }
        .delete-grade-btn:hover {
            color: #bd2130;
        }
        </style>
    </head>
    <body>
        <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Grade Management System</h1>
            <button id="back" class="btn btn-success" onclick="backToIndex()">Back</button>
        </div>
        
        <!-- Add New Grade Form -->
        <div class="card mb-4">
            <div class="card-body">
            <h5 class="card-title">Add New Grade</h5>
            <div class="input-group">
                <input type="text" id="newGrade" class="form-control" placeholder="Enter grade name" />
                <button class="btn btn-primary" onclick="addGrade()">Add Grade</button>
            </div>
            </div>
        </div>
        
        <!-- Grades Container -->
        <div id="gradesContainer" class="row">
            {% for grade, synonyms in grades.items() %}
            <div class="col-md-4">
                <div class="card grade-card">
                <div class="grade-header">
                    <h5 class="card-title mb-0">{{ grade }}</h5>
                    <i class="bi bi-trash delete-grade-btn" onclick="deleteGrade('{{ grade }}')" title="Delete Grade"></i>
                </div>
                <div class="card-body">
                    <div class="input-group mb-3">
                    <input type="text" class="form-control synonym-input" placeholder="Add synonym" />
                    <button class="btn btn-outline-primary" onclick="addSynonym('{{ grade }}', this)">Add</button>
                    </div>
                    <div class="synonym-list">
                    {% for synonym in synonyms %}
                        <div class="synonym-item">
                        <span>{{ synonym }}</span>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteSynonym('{{ grade }}', {{ loop.index0 }})"><i class="bi bi-trash"></i></button>
                        </div>
                    {% endfor %}
                    </div>
                </div>
                </div>
            </div>
            {% endfor %}
        </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script>
        function addGrade() {
            const gradeName = document.getElementById('newGrade').value.trim()
            if (!gradeName) return
        
            fetch('/api/grades', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ grade: gradeName })
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                location.reload()
                } else {
                alert(data.message)
                }
            })
        }
        
        function deleteGrade(grade) {
            if (!confirm(`Are you sure you want to delete the grade "${grade}" and all its synonyms?`)) return
        
            fetch(`/api/grades/${grade}`, {
            method: 'DELETE'
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                location.reload()
                } else {
                alert(data.message)
                }
            })
        }
        
        function addSynonym(grade, button) {
            const input = button.parentElement.querySelector('input')
            const synonym = input.value.trim()
            if (!synonym) return
        
            fetch(`/api/grades/${grade}/synonyms`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ synonym: synonym })
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                location.reload()
                } else {
                alert(data.message)
                }
            })
        }
        
        function deleteSynonym(grade, index) {
            if (!confirm('Are you sure you want to delete this synonym?')) return
        
            fetch(`/api/grades/${grade}/synonyms/${index}`, {
            method: 'DELETE'
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                location.reload()
                } else {
                alert(data.message)
                }
            })
        }
        function backToIndex(){
            window.location.href = '/'; 
        }
        </script>
    </body>
</html>
